<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>RCN Credit Marketplace - Documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/material.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">RCN Credit Marketplace - Documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>ModelConfig</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/utils/loan-utils.ts</code>
        </p>



        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#cuota">cuota</a>
                                </li>
                                <li>
                                        <a href="#duration">duration</a>
                                </li>
                                <li>
                                        <a href="#installments">installments</a>
                                </li>
                                <li>
                                        <a href="#interest_rate">interest_rate</a>
                                </li>
                                <li>
                                        <a href="#lent_time">lent_time</a>
                                </li>
                                <li>
                                        <a href="#time_unit">time_unit</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="cuota"></a>
                                        <span class="name"><b>cuota</b><a href="#cuota"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>cuota:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="duration"></a>
                                        <span class="name"><b>duration</b><a href="#duration"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>duration:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="installments"></a>
                                        <span class="name"><b>installments</b><a href="#installments"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>installments:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="interest_rate"></a>
                                        <span class="name"><b>interest_rate</b><a href="#interest_rate"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>interest_rate:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="lent_time"></a>
                                        <span class="name"><b>lent_time</b><a href="#lent_time"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>lent_time:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="time_unit"></a>
                                        <span class="name"><b>time_unit</b><a href="#time_unit"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>time_unit:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Loan, Network, Oracle, Descriptor, Debt, Config, Status, Model } from &#x27;../models/loan.model&#x27;;
import { LoanApiDiaspore } from &#x27;./../interfaces/loan-api-diaspore&#x27;;
import { LoanApiBasalt } from &#x27;./../interfaces/loan-api-basalt&#x27;;
import { Utils } from &#x27;./utils&#x27;;
import { environment } from &#x27;./../../environments/environment&#x27;;

interface ModelDebtInfo {
  paid: number;
  due_time: number;
  estimated_obligation: number;
  next_obligation: number;
  current_obligation: number;
  debt_balance: number;
  owner: string;
}

interface ModelConfig {
  installments: number;
  time_unit: number;
  duration: number;
  lent_time: number;
  cuota: number;
  interest_rate: number;
}

export class LoanUtils {
  static decodeInterest(raw: number): number {
    return 311040000000000 / raw;
  }
  static calculateInterest(_timeDelta: number, _interestRate: number, _amount: number): number {
    return (_amount * 100000 * _timeDelta) / _interestRate;
  }

  /**
   * Create basalt loan model from the api response
   * @param loanData Loan data obtained from API
   * @return Loan
   */
  static createBasaltLoan(loanData: LoanApiBasalt): Loan {
    const loanCurrencyWith0x &#x3D; &#x27;0x&#x27;;
    const engine: string &#x3D; environment.contracts.basaltEngine;
    const firstPayment: number &#x3D; loanData.cancelable_at;

    loanData.amount &#x3D; Number(loanData.amount);
    loanData.punitory_interest &#x3D; Number(loanData.punitory_interest);
    loanData.interest_timestamp &#x3D; Number(loanData.interest_timestamp);
    loanData.paid &#x3D; Number(loanData.paid);
    loanData.interest_rate &#x3D; Number(loanData.interest_rate);
    loanData.interest_rate_punitory &#x3D; Number(loanData.interest_rate_punitory);
    loanData.due_time &#x3D; Number(loanData.due_time);
    loanData.dues_in &#x3D; Number(loanData.dues_in);

    let oracle: Oracle;
    if (loanData.oracle !&#x3D;&#x3D; Utils.address0x) {
      oracle &#x3D; new Oracle(
        Network.Basalt,
        loanData.oracle,
        Utils.hexToAscii(loanData.currency.replace(/^[0x]+|[0]+$/g, &#x27;&#x27;)),
        loanData.currency
      );
    } else {
      oracle &#x3D; new Oracle(
        Network.Diaspore,
        loanData.oracle,
        &#x27;RCN&#x27;,
        loanCurrencyWith0x.concat(loanData.currency)
      );
    }

    // build debt if not a request
    let debt: Debt;

    if (loanData.status !&#x3D;&#x3D; Status.Request) {
      // run &quot;basalt&quot; model, emulate Diaspore model
      let pending;
      let deltaTime;
      let newInterest &#x3D; loanData.interest;
      let newPunitoryInterest &#x3D; loanData.punitory_interest;
      const timestamp &#x3D; new Date().getTime() / 1000;
      const endNonPunitory &#x3D; Math.min(timestamp, loanData.due_time);
      if (endNonPunitory &gt; loanData.interest_timestamp) {
        deltaTime &#x3D; endNonPunitory - loanData.interest_timestamp;

        if (loanData.paid &lt; loanData.amount) {
          pending &#x3D; loanData.amount - loanData.paid;
        } else {
          pending &#x3D; 0;
        }

        newInterest +&#x3D; this.calculateInterest(deltaTime, loanData.interest_rate, pending);
      }

      if (timestamp &gt; loanData.due_time) {
        const startPunitory &#x3D; Math.max(loanData.due_time, loanData.interest_timestamp);
        deltaTime &#x3D; timestamp - startPunitory;
        const debtAmount &#x3D; loanData.amount + newInterest;
        const pendingAmount &#x3D; Math.min(debtAmount, (debtAmount + newPunitoryInterest) - loanData.paid);
        newPunitoryInterest +&#x3D; this.calculateInterest(deltaTime, loanData.interest_rate_punitory, pendingAmount);
      }
      const totalAmount &#x3D; loanData.amount + newInterest + newPunitoryInterest;

      debt &#x3D; new Debt(
        Network.Basalt,
        loanData.index.toString(),
        new Model(
          Network.Basalt,
          engine,
          loanData.paid,
          totalAmount,
          totalAmount,
          totalAmount,
          loanData.due_time
        ),
        loanData.lender_balance,
        engine,
        loanData.lender,
        oracle
      );
    }

    return new Loan(
      Network.Basalt,
      loanData.index.toString(),
      engine,
      loanData.amount,
      oracle,
      new Descriptor(
        Network.Basalt,
        ((loanData.amount * 100000 * firstPayment) / loanData.interest_rate) + loanData.amount,
        ((loanData.amount * 100000 * loanData.dues_in) / loanData.interest_rate) + loanData.amount,
        loanData.dues_in,
        Utils.formatInterest(loanData.interest_rate),
        Utils.formatInterest(loanData.interest_rate_punitory),
        1,
        1
      ),
      loanData.borrower,
      loanData.creator,
      loanData.status,
      loanData.expiration_requests,
      &#x27;&#x27;,
      loanData.cosigner !&#x3D;&#x3D; Utils.address0x ? loanData.cosigner : undefined,
      debt
    );
  }

  /**
   * Create diaspore loan model from the api response
   * @param loanData Loan data obtained from API
   * @return Loan
   */
  static createDiasporeLoan(
    loanData: LoanApiDiaspore,
    debtInfo: ModelDebtInfo,
    modelConfig: ModelConfig
  ): Loan {
    const engine &#x3D; environment.contracts.diaspore.loanManager;

    let oracle: Oracle;
    if (loanData.oracle !&#x3D;&#x3D; Utils.address0x) {
      const currency &#x3D; loanData.currency ? Utils.hexToAscii(loanData.currency.replace(/^[0x]+|[0]+$/g, &#x27;&#x27;)) : &#x27;&#x27;;
      oracle &#x3D; new Oracle(
        Network.Diaspore,
        loanData.oracle,
        currency,
        loanData.currency
      );
    } else {
      oracle &#x3D; new Oracle(
        Network.Diaspore,
        loanData.oracle,
        &#x27;RCN&#x27;,
        loanData.currency
      );
    }

    let descriptor: Descriptor;
    let debt: Debt;
    let config: Config;

    descriptor &#x3D; new Descriptor(
      Network.Diaspore,
      Number(loanData.descriptor.first_obligation),
      Number(loanData.descriptor.total_obligation),
      Number(loanData.descriptor.duration),
      Number(loanData.descriptor.interest_rate),
      LoanUtils.decodeInterest(
        Number(loanData.descriptor.punitive_interest_rate)
      ),
      Number(loanData.descriptor.frequency),
      Number(loanData.descriptor.installments)
    );

    // set debt model
    if (debtInfo) {
      const paid &#x3D; debtInfo.paid;
      const dueTime &#x3D; debtInfo.due_time;
      const estimatedObligation &#x3D; debtInfo.estimated_obligation;
      const nextObligation &#x3D; debtInfo.next_obligation;
      const currentObligation &#x3D; debtInfo.current_obligation;
      const debtBalance &#x3D; debtInfo.debt_balance;
      const owner &#x3D; debtInfo.owner;
      debt &#x3D; new Debt(
        Network.Diaspore,
        loanData.id,
        new Model(
          Network.Diaspore,
          loanData.model,
          paid,
          nextObligation,
          currentObligation,
          estimatedObligation,
          dueTime
        ),
        debtBalance,
        engine,
        owner,
        oracle
      );
    }
    const status &#x3D; loanData.canceled ? Status.Destroyed : Number(loanData.status);

    if (modelConfig) {
      config &#x3D; new Config(
        Number(modelConfig.installments),
        Number(modelConfig.time_unit),
        Number(modelConfig.duration),
        Number(modelConfig.lent_time),
        Number(modelConfig.cuota),
        Number(modelConfig.interest_rate)
      );
    }

    return new Loan(
      Network.Diaspore,
      loanData.id,
      engine,
      Number(loanData.amount),
      oracle,
      descriptor,
      loanData.borrower,
      loanData.creator,
      status,
      Number(loanData.expiration),
      loanData.model,
      loanData.cosigner,
      debt,
      config
    );
  }
}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'ModelConfig.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
